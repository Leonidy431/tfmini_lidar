# ПАТЕНТНАЯ ДЕКЛАРАЦИЯ И ОПИСАНИЕ АКТИВА

## Идентификация актива

| Параметр | Значение |
|----------|----------|
| **Наименование актива** | BlueOS LiDAR SLAM Navigation System (BLSNS) |
| **Владелец/Изобретатель** | Leonidy431 |
| **Статус** | Proprietary Technology / Trade Secret |
| **Классификация актива** | Программное обеспечение (Software) |
| **Версия** | 1.0.0 |
| **Дата создания** | 2024 |
| **Репозиторий** | github.com/Leonidy431/tfmini_lidar |

---

## 1. ОБЛАСТЬ ТЕХНИКИ

Изобретение относится к области робототехники, автономной навигации
и компьютерного зрения, в частности к системам одновременной локализации
и картирования (SLAM) с использованием одноточечных ToF LiDAR сенсоров
для подводных и надводных беспилотных аппаратов.

## 2. УРОВЕНЬ ТЕХНИКИ

### 2.1 Существующие решения

Современные системы навигации подводных аппаратов (ROV/AUV) используют:

- Многолучевые сонары (высокая стоимость, большие габариты)
- DVL системы (дорогостоящие, требуют калибровки)
- Визуальная одометрия (неэффективна в мутной воде)
- GPS (недоступен под водой)

### 2.2 Технические проблемы

1. Высокая стоимость навигационного оборудования
2. Сложность интеграции с существующими системами управления
3. Отсутствие решений для записи и воспроизведения навигационных профилей
4. Ограниченные возможности детекции объектов в реальном времени

## 3. РАСКРЫТИЕ ИЗОБРЕТЕНИЯ

### 3.1 Техническая задача

Создание комплексной системы навигации на основе одноточечного
ToF LiDAR сенсора TFmini-S с функциями:

1. **Картирование окружающей среды** (SLAM)
2. **Запись навигационных профилей** для повторного прохождения маршрутов
3. **Детекция и классификация объектов** в реальном времени
4. **Локализация на предварительно созданной карте**

### 3.2 Технический результат

- Снижение стоимости навигационной системы на 80-90%
- Возможность автономного повторения записанных маршрутов
- Детекция препятствий с точностью до 5 см на расстоянии до 12 м
- Интеграция с BlueOS экосистемой через Docker контейнер

## 4. ОПИСАНИЕ КОМПОНЕНТОВ СИСТЕМЫ

### 4.1 Архитектура системы

```
┌─────────────────────────────────────────────────────────────────┐
│                    BlueOS LiDAR SLAM System                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌──────────────┐    ┌──────────────────┐   │
│  │  TFmini-S   │───▶│ LiDAR Driver │───▶│   Data Router    │   │
│  │   Sensor    │    │  (UART 115k) │    │                  │   │
│  └─────────────┘    └──────────────┘    └────────┬─────────┘   │
│                                                   │             │
│         ┌─────────────────────────────────────────┼───────┐     │
│         │                                         │       │     │
│         ▼                                         ▼       ▼     │
│  ┌──────────────┐   ┌──────────────────┐   ┌───────────────┐   │
│  │ SLAM Engine  │   │ Profile Recorder │   │    Object     │   │
│  │  (ICP Reg.)  │   │   & Navigator    │   │   Detector    │   │
│  └──────┬───────┘   └────────┬─────────┘   └───────┬───────┘   │
│         │                    │                     │           │
│         ▼                    ▼                     ▼           │
│  ┌──────────────┐   ┌──────────────────┐   ┌───────────────┐   │
│  │ Map Manager  │   │  Navigation      │   │   Pattern     │   │
│  │  (PLY/PCD)   │   │   Guidance       │   │   Analyzer    │   │
│  └──────────────┘   └──────────────────┘   └───────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              Flask REST API + WebSocket                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                  │
│                              ▼                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │           Web Interface (Three.js 3D Viewer)             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 Ключевые компоненты

#### 4.2.1 TFmini-S LiDAR Driver (`lidar_driver.py`)

Драйвер для работы с сенсором Benewake TFmini-S:

- **Протокол**: UART 115200 бод, 8N1
- **Формат кадра**: 9 байт с заголовком 0x59 0x59
- **Данные**: расстояние (0-12м), сила сигнала, температура
- **Частота**: настраиваемая 1-1000 Гц
- **Контрольная сумма**: LSB суммы первых 8 байт

```python
# Структура кадра TFmini-S
FRAME = [
    0x59, 0x59,           # Header
    Dist_L, Dist_H,       # Distance (cm)
    Strength_L, Strength_H,  # Signal strength
    Temp_L, Temp_H,       # Temperature raw
    Checksum              # Sum(bytes[0:8]) & 0xFF
]
```

#### 4.2.2 SLAM Engine (`slam_engine.py`)

Движок картирования на основе ICP (Iterative Closest Point):

- **Алгоритм**: Point-to-Plane ICP регистрация
- **Библиотека**: Open3D
- **Оптимизация**: вокселизация для ускорения обработки
- **Выход**: облако точек в формате PLY/PCD/NPY

**Новизна решения**:
- Адаптация ICP для одноточечного LiDAR через накопление псевдо-сканов
- Динамическое управление размером буфера
- Оценка дрейфа в реальном времени

#### 4.2.3 Profile Recorder & Navigator (`profile_recorder.py`)

Система записи и воспроизведения навигационных профилей:

**Waypoint структура**:
```python
@dataclass
class Waypoint:
    index: int                              # Порядковый номер
    timestamp: datetime                     # Временная метка
    position: Tuple[float, float, float]    # Координаты XYZ
    heading: float                          # Курс (градусы)
    distance_reading: float                 # Показание LiDAR
    signal_strength: int                    # Сила сигнала
    velocity: Tuple[float, float, float]    # Скорость
    features: Dict                          # Дополнительные признаки
```

**Навигационные режимы**:
1. `RECORDING` - запись маршрута с waypoints
2. `NAVIGATING` - воспроизведение с коррекцией
3. `LOCALIZING` - определение позиции на карте

#### 4.2.4 Object Detector (`object_detection.py`)

Система детекции и классификации объектов:

**Метод анализа паттернов**:
- Анализ изменения расстояния во времени (edge detection)
- Анализ вариации (flat surface detection)
- Анализ осцилляций (irregular surface detection)

**Классы объектов**:
| Класс | Паттерн | Характеристики |
|-------|---------|----------------|
| `wall` | flat_surface | низкая вариация, высокая сила сигнала |
| `obstacle` | edge_detected | резкие изменения расстояния |
| `pipe` | edge_detected | малый размер, средний сигнал |
| `rock` | irregular_surface | высокая вариация, средний сигнал |
| `debris` | irregular_surface | малый размер, слабый сигнал |

**Кластеризация**:
- DBSCAN-подобный алгоритм для группировки точек
- Оценка размеров объектов
- Отслеживание объектов во времени

#### 4.2.5 Localization Engine (`localization.py`)

Система локализации на предварительно созданной карте:

- **Метод**: ICP matching против референсного облака
- **Выход**: позиция (X, Y, Z) и уверенность (0-1)
- **Фильтрация**: экспоненциальное сглаживание позиции

#### 4.2.6 Map Manager (`map_manager.py`)

Управление картографическими данными:

- **Форматы**: PLY, PCD, NPY, HDF5
- **Метаданные**: JSON с границами, количеством точек, описанием
- **Траектории**: отдельное хранение путей
- **Версионирование**: поддержка нескольких версий карт

### 4.3 Интерфейсы

#### 4.3.1 REST API

| Endpoint | Method | Описание |
|----------|--------|----------|
| `/api/status` | GET | Статус системы |
| `/api/start` | POST | Запуск системы |
| `/api/stop` | POST | Остановка |
| `/api/mode/{mode}` | POST | Установка режима |
| `/api/mapping/start` | POST | Начать картирование |
| `/api/mapping/stop` | POST | Остановить картирование |
| `/api/profiles` | GET | Список профилей |
| `/api/profiles/{name}/record/start` | POST | Начать запись |
| `/api/profiles/{name}/navigate/start` | POST | Начать навигацию |
| `/api/objects` | GET | Список объектов |
| `/api/maps` | GET | Список карт |
| `/api/maps/{name}/save` | POST | Сохранить карту |
| `/api/maps/{name}/load` | POST | Загрузить карту |

#### 4.3.2 WebSocket Events

| Event | Direction | Данные |
|-------|-----------|--------|
| `lidar_reading` | Server→Client | distance, strength, temperature |
| `localization` | Server→Client | position, confidence |
| `navigation` | Server→Client | guidance, progress |
| `detection` | Server→Client | object class, position |
| `status` | Server→Client | system status |

### 4.4 Web Interface

- **Фреймворк**: Flask + SocketIO
- **3D визуализация**: Three.js
- **Режимы отображения**: Dashboard, Mapping, Navigation, Objects
- **Real-time обновление**: WebSocket

## 5. ФОРМУЛА ИЗОБРЕТЕНИЯ

### Пункт 1 (Независимый)

Система навигации для беспилотных аппаратов, включающая:

a) одноточечный ToF LiDAR сенсор, подключенный по UART интерфейсу;

b) модуль драйвера, выполненный с возможностью парсинга кадров
   фиксированной длины с проверкой контрольной суммы;

c) модуль SLAM, использующий ICP регистрацию накопленных псевдо-сканов
   для построения карты окружающей среды;

d) модуль записи профилей, сохраняющий waypoints с показаниями
   сенсора для последующего воспроизведения маршрута;

e) модуль детекции объектов, анализирующий паттерны изменения
   расстояния для классификации препятствий;

f) модуль локализации, определяющий позицию аппарата
   на предварительно созданной карте.

### Пункт 2 (Зависимый)

Система по п.1, отличающаяся тем, что модуль SLAM выполнен
с возможностью динамического управления размером буфера
накопления точек в зависимости от скорости движения аппарата.

### Пункт 3 (Зависимый)

Система по п.1, отличающаяся тем, что модуль записи профилей
сохраняет для каждого waypoint дополнительные признаки окружающей
среды для повышения точности навигации при воспроизведении.

### Пункт 4 (Зависимый)

Система по п.1, отличающаяся тем, что модуль детекции объектов
использует анализ вариации показаний расстояния во временном окне
для определения типа поверхности (плоская, неровная, край объекта).

### Пункт 5 (Зависимый)

Система по п.1, отличающаяся тем, что интегрирована с операционной
системой BlueOS посредством Docker контейнера с предоставлением
REST API и WebSocket интерфейсов.

## 6. ТЕХНИЧЕСКИЕ СПЕЦИФИКАЦИИ

### 6.1 Аппаратные требования

| Параметр | Требование |
|----------|------------|
| Процессор | ARM Cortex-A53 или выше |
| RAM | 1 GB минимум, 4 GB рекомендуется |
| Хранилище | 16 GB для карт и профилей |
| LiDAR | Benewake TFmini-S или совместимый |
| Интерфейс | UART (3.3V TTL) |

### 6.2 Программные зависимости

```
Python >= 3.9
Flask >= 3.0.0
Flask-SocketIO >= 5.3.0
Open3D >= 0.18.0
NumPy >= 1.24.0
SciPy >= 1.11.0
PySerial >= 3.5
PyMAVLink >= 2.4.0
```

### 6.3 Характеристики сенсора TFmini-S

| Параметр | Значение |
|----------|----------|
| Диапазон измерений | 0.1 - 12 м |
| Точность | ±6 см (0.1-6м), ±1% (6-12м) |
| Частота измерений | 1-1000 Гц |
| Поле зрения | 2.3° |
| Длина волны | 850 нм |
| Потребление | <0.12 Вт |
| Габариты | 42×15×16 мм |
| Масса | 5 г |

## 7. ПРИМЕРЫ ПРИМЕНЕНИЯ

### 7.1 Подводные ROV

- Инспекция подводных конструкций
- Картирование дна водоёмов
- Автоматический возврат по записанному маршруту
- Детекция препятствий при навигации

### 7.2 Надводные беспилотники

- Патрулирование акватории
- Картирование береговой линии
- Автономная навигация по каналам

### 7.3 Наземные роботы

- Навигация в помещениях
- Картирование складов
- Инспекция трубопроводов

## 8. ЗАКЛЮЧЕНИЕ

BlueOS LiDAR SLAM Navigation System представляет собой комплексное
решение для автономной навигации беспилотных аппаратов с использованием
недорогого одноточечного ToF LiDAR сенсора.

Ключевые преимущества:
- Низкая стоимость оборудования
- Простота интеграции через Docker
- Возможность записи и воспроизведения маршрутов
- Детекция и классификация объектов в реальном времени
- Открытый REST API для интеграции с внешними системами

---

## ИСТОРИЯ ИЗМЕНЕНИЙ

| Версия | Дата | Описание |
|--------|------|----------|
| 1.0.0 | 2024 | Первоначальная версия |

---

## УВЕДОМЛЕНИЕ О КОНФИДЕНЦИАЛЬНОСТИ

Данный документ содержит конфиденциальную информацию, являющуюся
коммерческой тайной. Распространение, копирование или использование
без письменного разрешения владельца запрещено.

© 2024 Leonidy431. Все права защищены.
